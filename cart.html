<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ—à–Ω–∏—Ü–∞ | TechStoreX</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <a href="index.html" class="logo">TechStoreX</a>
    <nav>
      <ul>
        <li><a href="index.html">–ù–∞—á–∞–ª–æ</a></li>
        <li><a href="Products.html">–ü—Ä–æ–¥—É–∫—Ç–∏</a></li>
        <li><a href="cart.html">üõí –ö–æ—à–Ω–∏—Ü–∞ <span id="cartCount"></span></a></li>
      </ul>
    </nav>
  </header>

  <main class="cart-wrap">
    <h1>–ú–æ—è—Ç–∞ –∫–æ—à–Ω–∏—Ü–∞</h1>

    <table class="cart-table" id="cartTable">
      <thead>
        <tr>
          <th>–°–Ω–∏–º–∫–∞</th>
          <th>–ü—Ä–æ–¥—É–∫—Ç</th>
          <th>–ï–¥. —Ü–µ–Ω–∞</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
          <th>–û–±—â–æ</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="cart-total" id="cartTotal"></div>
    <div class="cart-actions">
      <button id="clearCart" class="remove-btn">–ò–∑—á–∏—Å—Ç–∏ –∫–æ—à–Ω–∏—Ü–∞—Ç–∞</button>
      <a href="Products.html" class="btn-secondary">‚Üê –ü—Ä–æ–¥—ä–ª–∂–∏ –ø–∞–∑–∞—Ä—É–≤–∞–Ω–µ—Ç–æ</a>
      <a href="#" class="btn-primary" id="checkoutBtn">–ü–æ—Ä—ä—á–∞–π</a>
    </div>
  </main>

  <script src="cart-common.js?v=1"></script>
  <script>
    const CART_KEY = "techstore_cart";

    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
    function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderCart(); }

    function formatPrice(n){ return Number(n||0).toFixed(2) + " –ª–≤."; }

    function renderCart(){
      const tbody = document.querySelector("#cartTable tbody");
      const totalEl = document.getElementById("cartTotal");
      const cart = getCart();

      if (!cart.length){
        tbody.innerHTML = '<tr><td colspan="6" style="padding:20px;text-align:center;">–ö–æ—à–Ω–∏—Ü–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</td></tr>';
        totalEl.textContent = "";
        const badge = document.getElementById("cartCount");
        if (badge) badge.textContent = "";
        return;
      }

      let total = 0;
      tbody.innerHTML = cart.map(item => {
        const line = (Number(item.price)||0) * (Number(item.qty)||1);
        total += line;
        return `
          <tr data-id="${item.id}">
            <td><img src="${item.image || 'images/placeholder.png'}" alt="${item.name}"></td>
            <td style="text-align:left">
              <strong>${item.name}</strong><br>
              <a href="product.html?id=${item.id}">–í–∏–∂ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</a>
            </td>
            <td>${formatPrice(Number(item.price)||0)}</td>
            <td>
              <button class="qty-btn dec">-</button>
              <span style="display:inline-block;min-width:28px">${Number(item.qty)||1}</span>
              <button class="qty-btn inc">+</button>
            </td>
            <td>${formatPrice(line)}</td>
            <td><button class="remove-btn remove">–ü—Ä–µ–º–∞—Ö–Ω–∏</button></td>
          </tr>
        `;
      }).join("");

      totalEl.textContent = "–û–±—â–æ: " + formatPrice(total);

      const badge = document.getElementById("cartCount");
      if (badge){
        const totalQty = cart.reduce((s,i)=>s + (Number(i.qty)||1), 0);
        badge.textContent = totalQty || "";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderCart();

      document.querySelector("#cartTable").addEventListener("click", (e) => {
        const row = e.target.closest("tr[data-id]");
        if (!row) return;
        const id = row.getAttribute("data-id");
        let cart = getCart();
        const item = cart.find(i => String(i.id) === String(id));
        if (!item) return;

        if (e.target.classList.contains("inc")){
          item.qty = (Number(item.qty)||1) + 1;
          saveCart(cart);
        } else if (e.target.classList.contains("dec")){
          item.qty = (Number(item.qty)||1) - 1;
          if (item.qty <= 0) cart = cart.filter(i => String(i.id) !== String(id));
          saveCart(cart);
        } else if (e.target.classList.contains("remove")){
          cart = cart.filter(i => String(i.id) !== String(id));
          saveCart(cart);
        }
      });

      document.getElementById("clearCart").addEventListener("click", () => {
        if (confirm("–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—á–∏—Å—Ç–∏—Ç–µ –∫–æ—à–Ω–∏—Ü–∞—Ç–∞?")){
          localStorage.removeItem(CART_KEY);
          renderCart();
        }
      });

      document.getElementById("checkoutBtn").addEventListener("click", (e) => {
        e.preventDefault();
        alert();
      });
    });
  </script>
</body>
</html>



    renderCart();
  </script>
</body>

</html>

